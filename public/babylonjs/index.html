<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
    <title>Babylon - Getting Started</title>
    <!-- Link to the last version of BabylonJS -->
    <script src="https://preview.babylonjs.com/babylon.js"></script>
    <!-- Link to the last version of BabylonJS loaders to enable loading filetypes such as .gltf -->
    <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <!-- Link to pep.js to ensure pointer events work consistently in all browsers -->
    <!-- <script src="https://code.jquery.com/pep/0.4.1/pep.js"></script> -->
    <script src="https://ar.babylonjs.com/babylonAr.js"></script>

    <script src="game.js"></script>

    <style>
      html,
      body {
        overflow: hidden;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }

      #renderCanvas {
        width: 100%;
        height: 100%;
        touch-action: none;
      }
    </style>
  </head>
  <body>
    <canvas id="renderCanvas"></canvas>
    <script>
      window.addEventListener("DOMContentLoaded", function() {
        // get the canvas DOM element
        var canvas = document.getElementById("renderCanvas");

        // load the 3D engine
        var engine = new BABYLON.Engine(canvas, true);

        // createScene function that creates and return the scene
        var createScene = async function() {
          var scene = new BABYLON.Scene(engine);

          var light = new BABYLON.HemisphericLight(
            "light",
            new BABYLON.Vector3(0, 1, 0),
            scene
          );
          light.intensity = 0.7;

          var camera = await BabylonAR.ObjectTrackerCamera.CreateAsync(
            "camera",
            scene
          );

          const tracker = await BabylonAR.ArUcoMetaMarkerObjectTracker.CreateAsync(
            camera.videoTexture,
            scene
          );
          const trackedNode = await tracker.addTrackableObjectAsync(
            0,
            1,
            2,
            3,
            5
          );

          var mat = new BABYLON.StandardMaterial("mat", scene);
          // var texture = new BABYLON.Texture("https://i.imgur.com/lXehwjZ.jpg", scene);
          // mat.diffuseTexture = texture;

          var videoTexture = new BABYLON.VideoTexture(
            "video",
            ["textures/sample.mp4"],
            scene,
            true,
            true
          );
          mat.diffuseTexture = videoTexture;
          videoTexture.video.play();

          // var box = BABYLON.MeshBuilder.CreateBox("box", { size: 5.0 }, scene);
          var box = BABYLON.MeshBuilder.CreateBox(
            "box",
            { height: 5, width: 5, depth: 0.1 },
            scene
          );
          box.material = mat;
          box.parent = trackedNode;
          box.position.z += 0.1;

          tracker.startTracking();

          return scene;
        };

        // call the createScene function
        var scene = createScene();

        // run the render loop
        engine.runRenderLoop(function() {
          scene.render();
        });

        // the canvas/window resize event handler
        window.addEventListener("resize", function() {
          engine.resize();
        });
      });
    </script>
  </body>
</html>
